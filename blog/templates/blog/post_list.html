{% load static %}
<html>
    <head>
        <!-- Latest compiled and minified Bootstrap CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
            integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <title>
            First Blog Test
        </title>
        <style>
            #buttonId {margin-bottom: 10px;}
            #allImages { display: none };
            #allSortedImagesDiv { display: none };
        </style>
    </head>
    <body>
        <audio src="/static/LinusLucy.mp3"
            webkit-playsinline="true"
            allow="autoplay"
            autoplay="true">
        </audio>
        <h2>
            The Coops Holiday Update
        </h2>
        <div>
            <button id="buttonId" type="button" class="btn btn-info"
                onclick="startSS()">Click to Begin Slide Show</button>
        </div>
        <div id="allImages">
            <!-- Loop through Python posts and use data for HTML -->
            <!-- Note that values must be added for all fields in admin,
                even if not used (e.g. created/published dates). -->
            {% for post in posts %}
            <div class="ss">
            <p>
                <img src="/static/{{post.picture.url}}"
                    style="width:900px; height:550px">
            </p>
            <!-- OK <p>
                published: {{ post.published_date }}
            </p> -->
            <!-- <p>
                created: {{ post.created_date }}
            </p> -->
            <h3>
                <!-- OK <a ref="">{{ post.title }} </a> -->
                {{ post.title }}
            </h3>
            <p>
                {{ post.description|linebreaksbr }}
            </p>
            </div>
            {% endfor %}
        </div>
        <div id="output">
            <img src="{% static 'snlIntro.jpg' %}"
                alt="SVNet Image">
        </div>
        <div id="allSortedImagesDiv"></div>
    </body>

    <script>
        function startSS() {
            console.log("Start SlideShow");

        console.log("Here is some javascript...");
        playMusic();
        document.getElementById("allImages").style.display = "none";
        let slides = document.getElementsByClassName("ss");
        let slidesArray = [];
        // Get rid of the whitespace text nodes
        for (var i in slides) {
            if (slides[i].nodeType == 1) {
            console.log("Slide pre sort = " + slides[i].innerHTML);
                slidesArray.push(slides[i]);
            }
        }

        // Sort by alpha on Description field (elem [2])
        slidesArray.sort(function(a, b) {
            let aDesc = a.children[2].innerHTML.trim();
            let bDesc = b.children[2].innerHTML.trim();
            return aDesc == bDesc
                ? 0
                // Ascending : (aDesc > bDesc ? 1 : -1);
                : (aDesc < bDesc ? 1 : -1); // Descending
        });

        allSortedImages = document.getElementById("allSortedImagesDiv");
        for (i = 0; i < slidesArray.length; ++i) {
            console.log("Slide post sort = " + slidesArray[i].innerHTML);
            allSortedImages.appendChild(slidesArray[i]);
            allSortedImages.style.display = "none";
        }

       (function slideLoop (i) {
            let element = document.getElementById("output");
            // Don't show index (description).
            slides[i-1].children[2].style.display = "none";
            element.innerHTML = slidesArray[i-1].outerHTML;
            unfade(element);
            setTimeout(() => {
                fade(element);
                setTimeout(() => {
                    // decrement i and call myLoop again if i > 0
                    if (--i) slideLoop(i);
                    else {
                        stopMusic();
                        console.log("Slide Show Done");
                    }
                }, 2000);
            }, 3000);

       })(slidesArray.length);
    }

    function fade(element) {
    var op = 1;  // initial opacity
    var timer = setInterval(function () {
        if (op <= 0.1){
            clearInterval(timer);
            element.style.display = 'none';
        }
        element.style.opacity = op;
        element.style.filter = 'alpha(opacity=' + op * 100 + ")";
        op -= op * 0.1;
    }, 50);
    }

    function unfade(element) {
    var op = 0.1;  // initial opacity
    element.style.display = 'block';
    var timer = setInterval(function () {
        if (op >= 1){
            clearInterval(timer);
        }
        element.style.opacity = op;
        element.style.filter = 'alpha(opacity=' + op * 100 + ")";
        op += op * 0.1;
    }, 10);
    }

    function playMusic() {
        setTimeout(() => {
        console.log("In playMusic()");
        var v = document.getElementsByTagName("audio")[0];
        v.load();
        v.play();
        }, 100 );
        // let body = document.getElementsByTagName("BODY")[0];
        // body.prepend('<audio src="https://www.w3schools.com/tags/horse.ogg" controls></audio>');
    }

    function stopMusic() {
        console.log("In stopMusic()");
        var v = document.getElementsByTagName("audio")[0];
        v.pause();
    }
    </script>
</html>